<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexiPractice Suite | Pro Hybrid</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: radial-gradient(circle at top right, #f8fafc, #f1f5f9);
        }

        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .active-tab {
            background: var(--primary);
            color: white;
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.3);
            transform: translateY(-2px);
        }

        .word-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .word-card:hover {
            transform: scale(1.05) rotate(1deg);
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }

        .btn-bounce:active {
            transform: scale(0.95);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        @keyframes pulse-border {
            0%, 100% { border-color: rgba(99, 102, 241, 0.2); }
            50% { border-color: rgba(99, 102, 241, 0.6); }
        }

        .timer-active {
            animation: pulse-border 2s infinite;
        }
    </style>
</head>
<body class="min-h-screen text-slate-800 pb-20">

    <div id="app" class="max-w-4xl mx-auto p-4 md:p-8 animate__animated animate__fadeIn">
        
        <!-- Animated Header -->
        <header class="mb-12 text-center relative">
            <div class="absolute -top-10 left-1/2 -translate-x-1/2 w-32 h-32 bg-indigo-100 blur-3xl opacity-50 rounded-full -z-10"></div>
            <h1 class="text-5xl font-extrabold text-slate-900 tracking-tight mb-3">
                Lexi<span class="text-indigo-600">Practice</span>
            </h1>
            <p class="text-slate-500 font-medium">Elevate your linguistic precision with AI-driven analysis.</p>
            
            <div class="mt-6 flex flex-wrap justify-center gap-3">
                <div class="glass border border-slate-200 rounded-2xl px-4 py-2 flex items-center shadow-sm">
                    <span class="text-[10px] font-bold mr-2 uppercase tracking-widest text-slate-400">Engine</span>
                    <select id="engine-mode" class="text-xs font-bold text-indigo-600 bg-transparent outline-none cursor-pointer">
                        <option value="ai">Cloud AI (Rigorous)</option>
                        <option value="local">Local Heuristic (Fast)</option>
                    </select>
                </div>
                
                <div class="glass border border-slate-200 rounded-2xl px-4 py-2 flex items-center shadow-sm">
                    <span class="text-[10px] font-bold mr-2 uppercase tracking-widest text-slate-400">Timer</span>
                    <select id="timer-toggle" onchange="toggleTimerSettings()" class="text-xs font-bold text-slate-600 bg-transparent outline-none cursor-pointer">
                        <option value="no">Disabled</option>
                        <option value="yes">Enabled</option>
                    </select>
                    <input type="number" id="timer-duration" value="120" class="hidden ml-2 w-12 text-xs font-bold text-indigo-600 bg-transparent outline-none" title="Seconds">
                </div>
            </div>
        </header>

        <!-- Dynamic Navigation -->
        <nav class="flex justify-center space-x-2 mb-10 p-1.5 bg-slate-100/50 rounded-3xl max-w-sm mx-auto backdrop-blur-sm">
            <button onclick="window.location.href='/main'" class="flex-1 py-2.5 rounded-2xl font-semibold transition-all duration-300 text-sm">Return to Lexicon</button>
            <button onclick="switchTab('manage')" class="flex-1 py-2.5 rounded-2xl font-semibold transition-all duration-300 text-sm" id="tab-manage">Lexicon</button>
            <button onclick="switchTab('test')" class="flex-1 py-2.5 rounded-2xl font-semibold transition-all duration-300 text-sm" id="tab-test">Assessment</button>
            <button onclick="switchTab('history')" class="flex-1 py-2.5 rounded-2xl font-semibold transition-all duration-300 text-sm" id="tab-history">Archives</button>
        </nav>

        <!-- Section: Manage -->
        <section id="section-manage" class="space-y-8 animate__animated animate__fadeInUp">
            <div class="glass p-8 rounded-3xl shadow-xl border border-white">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    Expand Vocabulary
                </h2>
                <div class="flex gap-3 mb-6">
                    <input type="text" id="new-word" onkeypress="if(event.key==='Enter') addWord()" placeholder="Enter a sophisticated term..." class="flex-1 px-5 py-3 bg-white/50 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 outline-none transition-all">
                    <button onclick="addWord()" class="bg-indigo-600 text-white px-8 py-3 rounded-2xl hover:bg-indigo-700 transition shadow-lg shadow-indigo-200 font-bold btn-bounce">Add</button>
                </div>
                <div class="relative">
                    <textarea id="import-area" rows="3" placeholder="Bulk import (e.g., Ephemeral, Mellifluous...)" class="w-full px-5 py-4 bg-white/50 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 outline-none text-sm transition-all"></textarea>
                    <button onclick="importWords()" class="absolute bottom-4 right-4 text-xs font-bold text-indigo-600 hover:text-indigo-800">Process List</button>
                </div>
            </div>

            <div class="glass p-8 rounded-3xl shadow-xl border border-white">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-xl font-bold">Stored Lexemes</h2>
                        <span id="word-count-badge" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">0 WORDS</span>
                    </div>
                    <button onclick="clearAllWords()" class="bg-red-50 text-red-500 px-4 py-2 rounded-xl text-xs font-bold hover:bg-red-100 transition btn-bounce">
                        Purge Lexicon
                    </button>
                </div>
                <div id="word-list" class="flex flex-wrap gap-3"></div>
            </div>
        </section>

        <!-- Section: Test -->
        <section id="section-test" class="hidden space-y-6 animate__animated animate__fadeInUp">
            <div id="config-card" class="glass p-8 rounded-3xl shadow-xl border border-white text-center">
                <div class="w-16 h-16 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                </div>
                <h2 class="text-2xl font-bold mb-2">Prepare Assessment</h2>
                <p class="text-slate-500 mb-8">Define your constraints for this session.</p>
                
                <div class="grid grid-cols-2 gap-4 max-w-sm mx-auto mb-8">
                    <div class="text-left">
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">Selection</label>
                        <select id="selection-mode" class="w-full mt-1 px-4 py-3 bg-white border border-slate-200 rounded-2xl font-semibold">
                            <option value="count">Fixed Count</option>
                            <option value="percent">Percentage</option>
                        </select>
                    </div>
                    <div class="text-left">
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">Quantity</label>
                        <input type="number" id="selection-value" value="3" class="w-full mt-1 px-4 py-3 bg-white border border-slate-200 rounded-2xl font-semibold">
                    </div>
                </div>
                <button onclick="startTest()" class="bg-slate-900 text-white px-12 py-4 rounded-2xl font-bold hover:bg-black transition shadow-xl btn-bounce">Begin Session</button>
            </div>

            <div id="test-area" class="hidden space-y-6">
                <!-- Floating Timer Indicator -->
                <div id="timer-display-container" class="hidden flex justify-center">
                    <div class="bg-white border-2 border-indigo-100 px-6 py-2 rounded-full shadow-lg flex items-center gap-3 timer-active">
                        <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                        <span id="timer-countdown" class="font-mono text-xl font-black text-slate-700">00:00</span>
                    </div>
                </div>

                <div class="bg-indigo-600 p-8 rounded-[2rem] shadow-2xl shadow-indigo-200 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 20 20"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path></svg>
                    </div>
                    <h3 class="text-xs font-black uppercase tracking-[0.2em] opacity-60 mb-4">Mandatory Vocabulary</h3>
                    <div id="target-words" class="flex flex-wrap gap-2 relative z-10"></div>
                </div>
                
                <div class="glass p-8 rounded-[2rem] shadow-xl border border-white">
                    <textarea id="paragraph-input" rows="8" placeholder="Begin framing your narrative..." class="w-full px-6 py-6 bg-transparent border-none focus:ring-0 outline-none text-xl leading-relaxed italic text-slate-700 placeholder:text-slate-300"></textarea>
                    <div class="flex items-center justify-between mt-6 pt-6 border-t border-slate-100">
                        <span id="char-count" class="text-xs font-bold text-slate-400">0 CHARACTERS</span>
                        <button id="submit-btn" onclick="submitTest()" class="bg-indigo-600 text-white px-10 py-4 rounded-2xl font-bold hover:bg-indigo-700 transition shadow-lg shadow-indigo-100 btn-bounce">Finalize Submission</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: History -->
        <section id="section-history" class="hidden space-y-4 animate__animated animate__fadeInUp">
            <div id="history-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </section>

        <!-- Premium Report Modal -->
        <div id="modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-xl hidden flex items-center justify-center p-4 z-50 animate__animated animate__fadeIn">
            <div class="bg-white max-w-2xl w-full rounded-[3rem] p-10 shadow-2xl overflow-y-auto max-h-[90vh] animate__animated animate__zoomIn">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-black text-slate-900">Linguistic Analysis</h2>
                        <p id="modal-date" class="text-slate-400 text-xs font-bold uppercase tracking-widest mt-1"></p>
                    </div>
                    <div id="score-badge" class="w-24 h-24 rounded-3xl text-white font-black text-3xl bg-indigo-600 flex items-center justify-center shadow-2xl shadow-indigo-200 rotate-3">0%</div>
                </div>
                
                <div class="space-y-8">
                    <div class="bg-slate-50 p-8 rounded-3xl border border-slate-100 relative">
                        <div class="absolute -top-3 left-6 bg-white border border-slate-100 px-3 py-1 rounded-full text-[10px] font-bold text-slate-400">PROFESSOR'S FEEDBACK</div>
                        <div id="ai-feedback" class="text-slate-700 leading-relaxed font-medium italic text-lg"></div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-6">
                        <div class="p-6 rounded-3xl bg-emerald-50 border border-emerald-100 text-center">
                            <span class="text-[10px] font-black text-emerald-600 uppercase tracking-widest">Syntax Grade</span>
                            <div id="grammar-score" class="text-3xl font-black text-emerald-700 mt-1">A+</div>
                        </div>
                        <div class="p-6 rounded-3xl bg-blue-50 border border-blue-100 text-center">
                            <span class="text-[10px] font-black text-blue-600 uppercase tracking-widest">Vocabulary</span>
                            <div id="usage-score" class="text-3xl font-black text-blue-700 mt-1">Fluent</div>
                        </div>
                    </div>

                    <div id="time-taken-box" class="hidden p-4 rounded-2xl bg-amber-50 border border-amber-100 text-center">
                         <span class="text-[10px] font-black text-amber-600 uppercase">Time Completion</span>
                         <div id="time-result" class="text-lg font-bold text-amber-700">00:00</div>
                    </div>
                </div>

                <button onclick="closeModal()" class="w-full mt-10 bg-slate-900 text-white py-5 rounded-[2rem] font-bold text-lg hover:bg-black transition shadow-xl">Return to Study</button>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "AIzaSyBwTbSjJM0Vk5PTzl_YHg9fcQSnwAGyCfg"; 
        const WORDS_KEY = 'lexipractice_words_v3';
        const HISTORY_KEY = 'lexipractice_history_v3';

        let words = [];
        let history = [];
        let currentTestWords = [];
        let timerInterval = null;
        let timeElapsed = 0;
        let timeLimit = 0;

        async function loadData() {
            try {
                const resW = await fetch(`/api/storage/${WORDS_KEY}`);
                const resH = await fetch(`/api/storage/${HISTORY_KEY}`);
                words = (await resW.json()) || [];
                history = (await resH.json()) || [];
            } catch (e) {
                console.error("Data load failed. Resetting arrays.");
                words = [];
                history = [];
            }
            renderWords();
            renderHistory();
        }

        async function saveData() {
            await fetch(`/api/storage/${WORDS_KEY}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(words)
            });
            await fetch(`/api/storage/${HISTORY_KEY}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(history)
            });
        }

        function toggleTimerSettings() {
            const isEnabled = document.getElementById('timer-toggle').value === 'yes';
            document.getElementById('timer-duration').classList.toggle('hidden', !isEnabled);
        }

        // --- Word Management ---
        function addWord() {
            const input = document.getElementById('new-word');
            const val = input.value.trim().toLowerCase();
            if (!val || words.some(w => w.text === val)) return;
            words.push({ id: crypto.randomUUID(), text: val, date: Date.now() });
            saveData(); 
            renderWords(); 
            input.value = '';
        }

        function importWords() {
            const area = document.getElementById('import-area');
            const list = area.value.split(/[\n\s,]+/).map(w => w.trim().toLowerCase()).filter(w => w && !words.some(ex => ex.text === w));
            list.forEach(text => words.push({ id: crypto.randomUUID(), text, date: Date.now() }));
            saveData(); 
            renderWords(); 
            area.value = '';
        }

        function renderWords() {
            const container = document.getElementById('word-list');
            const badge = document.getElementById('word-count-badge');
            if(badge) badge.innerText = `${words.length} WORDS`;
            
            if(container) {
                container.innerHTML = words.map(w => `
                    <div class="word-card bg-white px-4 py-2 rounded-2xl border border-slate-200 flex items-center gap-3 shadow-sm group animate__animated animate__fadeIn">
                        <span class="text-sm font-bold text-slate-700">${w.text}</span>
                        <button onclick="deleteWord('${w.id}')" class="text-slate-300 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100">✕</button>
                    </div>
                `).join('') || '<p class="text-slate-400 text-sm italic w-full text-center py-4">Your lexicon currently lies fallow.</p>';
            }
        }

        function deleteWord(id) { 
            words = words.filter(w => w.id !== id); 
            saveData(); 
            renderWords(); 
        }

        /**
         * Hardened Clear Function
         * Explicitly targets the keys and resets state variables.
         */
        async function clearAllWords() { 
            if(!confirm("Are you certain you wish to purge your entire lexicon? This action is irreversible.")) return;
            // Reset Memory
            words = []; 
            // Persist empty array to server storage
            await fetch(`/api/storage/${WORDS_KEY}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify([])
            });
            // Update UI immediately
            renderWords();
            console.log("Lexicon purged successfully.");
        }

        // --- Tabs ---
        function switchTab(tab) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-tab'));
            document.getElementById(`section-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).classList.add('active-tab');
            if (tab === 'test') {
                document.getElementById('config-card').classList.remove('hidden');
                document.getElementById('test-area').classList.add('hidden');
                clearInterval(timerInterval);
            }
        }

        // --- Timer Logic ---
        function startTimer(durationSeconds) {
            timeElapsed = 0;
            timeLimit = durationSeconds;
            updateTimerDisplay(durationSeconds);
            
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeElapsed++;
                const remaining = timeLimit - timeElapsed;
                updateTimerDisplay(remaining);
                
                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    alert("Temporal limit reached. Evaluation will proceed with current input.");
                    submitTest();
                }
            }, 1000);
        }

        function updateTimerDisplay(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            const display = document.getElementById('timer-countdown');
            if(display) display.innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        function startTest() {
            if (words.length < 1) return alert("Lexicon empty.");
            const mode = document.getElementById('selection-mode').value;
            const val = parseInt(document.getElementById('selection-value').value);
            let count = mode === 'percent' ? Math.max(1, Math.floor((val/100)*words.length)) : val;
            count = Math.min(count, words.length);
            
            currentTestWords = [...words].sort(() => 0.5 - Math.random()).slice(0, count).map(w => w.text);
            document.getElementById('target-words').innerHTML = currentTestWords.map(t => `<span class="bg-white/20 px-4 py-2 rounded-xl text-sm font-black border border-white/30 backdrop-blur-sm animate__animated animate__backInDown">${t}</span>`).join('');
            
            document.getElementById('config-card').classList.add('hidden');
            document.getElementById('test-area').classList.remove('hidden');
            document.getElementById('paragraph-input').value = '';
            document.getElementById('paragraph-input').focus();

            const timerEnabled = document.getElementById('timer-toggle').value === 'yes';
            if (timerEnabled) {
                const duration = parseInt(document.getElementById('timer-duration').value) || 120;
                document.getElementById('timer-display-container').classList.remove('hidden');
                startTimer(duration);
            } else {
                document.getElementById('timer-display-container').classList.add('hidden');
            }
        }

        // --- Evaluation Engine ---
        async function submitTest() {
            if (timerInterval) clearInterval(timerInterval);
            const text = document.getElementById('paragraph-input').value.trim();
            if (!text) return;

            const engine = document.getElementById('engine-mode').value;
            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            btn.innerText = "SCRUTINIZING...";

            let resultData;
            if (engine === 'ai') resultData = await evaluateWithAI(text);
            else resultData = evaluateLocally(text);

            if (resultData) {
                const session = {
                    id: crypto.randomUUID(),
                    text,
                    targets: currentTestWords,
                    timestamp: Date.now(),
                    timeSpent: timeElapsed,
                    ...resultData
                };
                history.push(session);
                saveData();
                renderHistory();
                showResult(session);
            }

            btn.disabled = false;
            btn.innerText = "Finalize Submission";
        }

        function evaluateLocally(text) {
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const wordsInText = text.toLowerCase().replace(/[.,!?;:()]/g, " ").split(/\s+/);
            
            let foundCount = 0;
            currentTestWords.forEach(w => { if(wordsInText.includes(w.toLowerCase())) foundCount++; });
            const vocabularyAccuracy = (foundCount / currentTestWords.length) * 100;
            const startsWithCapital = sentences.length > 0 && sentences.every(s => /^[A-Z]/.test(s.trim()));

            return {
                overallScore: Math.round(vocabularyAccuracy),
                grammarGrade: startsWithCapital ? "B" : "C-",
                usageFeedback: foundCount === currentTestWords.length ? "Integrated" : "Incomplete",
                aiAnalysis: "Offline Evaluation: Success. Full AI analysis requires active cloud connection."
            };
        }

        async function evaluateWithAI(text) {
            const systemPrompt = `Strict Writing Tutor. Target Words: [${currentTestWords.join(', ')}]. Return JSON only: {overallScore: 0-100, grammarGrade: "string", usageFeedback: "string", aiAnalysis: "string"}.`;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                const data = await response.json();
                return JSON.parse(data.candidates[0].content.parts[0].text);
            } catch (err) {
                return evaluateLocally(text);
            }
        }

        function showResult(s) {
            document.getElementById('modal-date').innerText = new Date(s.timestamp).toLocaleString();
            document.getElementById('score-badge').innerText = `${s.overallScore}%`;
            document.getElementById('ai-feedback').innerText = s.aiAnalysis;
            document.getElementById('grammar-score').innerText = s.grammarGrade;
            document.getElementById('usage-score').innerText = s.usageFeedback;
            
            if (s.timeSpent > 0) {
                document.getElementById('time-taken-box').classList.remove('hidden');
                document.getElementById('time-result').innerText = `${Math.floor(s.timeSpent/60)}m ${s.timeSpent%60}s`;
            } else {
                document.getElementById('time-taken-box').classList.add('hidden');
            }
            document.getElementById('modal').classList.remove('hidden');
        }

        async function renderHistory() {
             const list = document.getElementById('history-list');
             if(!list) return;
             // make sure latest history is loaded from server
             try {
                 const res = await fetch(`/api/storage/${HISTORY_KEY}`);
                 history = (await res.json()) || [];
             } catch (e) { history = history || []; }
             const sorted = [...history].sort((a,b) => b.timestamp - a.timestamp);
             list.innerHTML = sorted.map(h => `
                 <div class="glass p-6 rounded-[2rem] border border-white shadow-sm hover:shadow-xl transition-all group animate__animated animate__fadeIn">
                     <div class="flex justify-between mb-4">
                         <span class="text-[10px] font-black text-slate-300 uppercase tracking-widest">${new Date(h.timestamp).toLocaleDateString()}</span>
                         <div class="flex gap-2">
                              <span class="text-sm font-black text-indigo-600">${h.overallScore}%</span>
                              <button onclick='deleteHistory("${h.id}")' class="text-slate-200 hover:text-red-400">✕</button>
                         </div>
                     </div>
                     <p class="text-slate-600 text-sm line-clamp-3 mb-4 italic leading-relaxed">"${h.text}"</p>
                     <button onclick='viewHistoryItem("${h.id}")' class="w-full py-2 bg-slate-50 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-400 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors">Inspect Session</button>
                 </div>
             `).join('') || '<p class="text-center text-slate-300 py-12 col-span-full">No archives found.</p>';
         }

        function viewHistoryItem(id) { const item = history.find(h => h.id === id); if(item) showResult(item); }
        function deleteHistory(id) { 
            history = history.filter(h => h.id !== id); 
            saveData(); 
            renderHistory(); 
        }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); switchTab('history'); }

        document.getElementById('paragraph-input').addEventListener('input', (e) => {
             document.getElementById('char-count').innerText = `${e.target.value.length} CHARACTERS`;
         });
 
        window.onload = loadData;
     </script>
 </body>
 </html>